# Quick Start Guide

## Prerequisites

- Go 1.21 or higher
- OpenSSL (for generating keys)
- SQLite3

## Installation & Setup

1. **Run the setup script:**
   ```bash
   ./setup.sh
   ```
   
   This will:
   - Create necessary directories
   - Generate RSA key pairs for JWT signing
   - Create `.env` file from template
   - Download Go dependencies
   - Build the application

2. **Seed the database:**
   ```bash
   go run scripts/seed.go
   ```
   
   This creates:
   - Test user: `testuser` with password `password123`
   - Test OAuth client with credentials (saved to console)
   
   **Important:** Save the Client ID and Client Secret from the output!

3. **Start the server:**
   ```bash
   make run
   # or
   ./bin/openid-server
   # or
   go run cmd/server/main.go
   ```

4. **Verify it's running:**
   ```bash
   curl http://localhost:8080/health
   # Should return: {"status":"ok"}
   ```

## Testing the OpenID Flow

### Option 1: Use the Test Client

```bash
# In a new terminal, start the test client
go run examples/test-client.go
```

Then open http://localhost:9090 in your browser and follow the flow.

### Option 2: Manual Testing

1. **Discovery:**
   ```bash
   curl http://localhost:8080/.well-known/openid-configuration
   ```

2. **Get JWKS:**
   ```bash
   curl http://localhost:8080/.well-known/jwks.json
   ```

3. **Authorization (in browser):**
   ```
   http://localhost:8080/authorize?client_id=YOUR_CLIENT_ID&redirect_uri=http://localhost:9090/callback&response_type=code&scope=openid%20profile%20email&state=test123
   ```
   
   Login with: `testuser` / `password123`

4. **Exchange code for tokens:**
   ```bash
   curl -X POST http://localhost:8080/token \
     -u "CLIENT_ID:CLIENT_SECRET" \
     -d "grant_type=authorization_code&code=AUTH_CODE&redirect_uri=http://localhost:9090/callback"
   ```

5. **Get user info:**
   ```bash
   curl http://localhost:8080/userinfo \
     -H "Authorization: Bearer ACCESS_TOKEN"
   ```

## Project Structure

```
openid-golang/
├── cmd/
│   └── server/
│       └── main.go              # Application entry point
├── internal/
│   ├── config/
│   │   └── config.go            # Configuration management
│   ├── crypto/
│   │   ├── jwt.go               # JWT generation & validation
│   │   └── utils.go             # Crypto utilities (PKCE, password hashing)
│   ├── handlers/
│   │   ├── handlers.go          # Base handlers
│   │   ├── authorize.go         # Authorization endpoint
│   │   ├── token.go             # Token endpoint
│   │   ├── userinfo.go          # UserInfo endpoint
│   │   └── discovery.go         # Discovery & JWKS endpoints
│   ├── middleware/
│   │   └── middleware.go        # HTTP middleware
│   ├── models/
│   │   └── models.go            # Data models
│   └── storage/
│       ├── storage.go           # Storage interface
│       └── sqlite.go            # SQLite implementation
├── scripts/
│   └── seed.go                  # Database seeding script
├── examples/
│   └── test-client.go           # Test OAuth client
├── docs/
│   ├── API.md                   # API documentation
│   └── TESTING.md               # Testing guide
├── config/
│   └── keys/                    # RSA keys (generated by setup)
├── go.mod                       # Go module file
├── Makefile                     # Build commands
├── setup.sh                     # Setup script
└── README.md                    # Main documentation
```

## Environment Variables

Configure via `.env` file or environment variables:

- `SERVER_HOST` - Server host (default: 0.0.0.0)
- `SERVER_PORT` - Server port (default: 8080)
- `DB_TYPE` - Database type: sqlite or postgres (default: sqlite)
- `DB_CONNECTION` - Database connection string
- `JWT_PRIVATE_KEY` - Path to RSA private key
- `JWT_PUBLIC_KEY` - Path to RSA public key
- `JWT_EXPIRY_MINUTES` - Token expiry in minutes (default: 60)
- `ISSUER` - OIDC issuer URL (default: http://localhost:8080)

## OpenID Connect Endpoints

- **Discovery:** `GET /.well-known/openid-configuration`
- **JWKS:** `GET /.well-known/jwks.json`
- **Authorization:** `GET /authorize`
- **Token:** `POST /token`
- **UserInfo:** `GET /userinfo`
- **Health:** `GET /health`

## Next Steps

1. Review the [API Documentation](docs/API.md)
2. Read the [Testing Guide](docs/TESTING.md)
3. Integrate with your application
4. Customize user authentication
5. Add database persistence for production
6. Configure HTTPS for production use
7. Implement proper session management
8. Add rate limiting and security hardening

## Development Commands

```bash
# Build
make build

# Run
make run

# Test
make test

# Format code
make fmt

# Clean build artifacts
make clean

# Download dependencies
make deps

# Generate new RSA keys
make generate-keys
```

## Troubleshooting

**Server won't start:**
- Check if port 8080 is already in use
- Verify RSA keys exist in `config/keys/`
- Check database connection

**Authentication fails:**
- Verify test user exists (run seed script)
- Check username and password

**Token exchange fails:**
- Verify client credentials
- Check redirect URI matches exactly
- Ensure authorization code hasn't expired (10 minutes)

**JWT validation fails:**
- Check RSA keys are properly generated
- Verify issuer URL matches configuration

## Security Considerations for Production

⚠️ **This is a development/example implementation. For production:**

1. Use HTTPS (TLS/SSL)
2. Use PostgreSQL instead of SQLite
3. Implement proper session management
4. Add rate limiting
5. Enable CSRF protection
6. Implement account lockout after failed attempts
7. Add audit logging
8. Use strong key management (HSM, KMS)
9. Implement client registration
10. Add support for client authentication methods
11. Implement proper consent screens
12. Add multi-factor authentication
13. Implement token revocation
14. Add introspection endpoint

## Contributing

Feel free to submit issues and enhancement requests!

## License

MIT License
